{% extends "/layout/profile.html" %}


{% from "/macros/analytics.html" import utagDataScript %}
{% from "/macros/breadcrumb/breadcrumb.html" import breadcrumb %}
{% from "/macros/profile/profile-lead-form.html" import LeadModal %}

{% block contentSection %}

{% from "/pages/profile/components/grid-features.html" import productFeatures %}
{% from "/pages/profile/components/bundles.html" import productBundles %}
{% from "/pages/profile/components/reviews.html" import reviews %}
{% from "/pages/profile/components/policies-support.html" import support %}
{% from "/pages/profile/components/addons.html" import addons %}
{% from "/macros/profile/profile-lead-form.html" import leadForm %}


{% block content %}
{% from "/pages/profile/components/product-summary.html" import productSummary %}
{% from "/pages/profile/components/editions-pricing.html" import editionsPricing with context %}
{% from "/pages/profile/components/addon-products.html" import addonProducts with context %}
{% from "/macros/sliders/carousel.html" import carousel with context %}
{% from "/pages/profile/components/simple-tabs.html" import productTabs %}
{% from "/pages/profile/components/overview.html" import productOverview %}
{% from "/pages/profile/components/support.html" import productSupport with context %}

{% set breadcrumbData = [{label: i18n.Home, link: '/'+ config.locale.code +'/home'}] %}
{% if application.categories.items.length > 0 %}
{% set breadcrumbData = (breadcrumbData.push({label: application.categories.items[0].label, link:  application.categories.items[0].href}), breadcrumbData) %}
{% endif %}
{% set breadcrumbData = (breadcrumbData.push({label: application.summary.title}), breadcrumbData) %}

{% block data %}
<data type="navigator"/>
{% endblock %}

{{breadcrumb(breadcrumbData)}}
<script src="{{ r('/assets/js/action-api.js') }}"></script>
<script src="{{ r('/assets/js/profile-leads.js') }}"></script>

<div class="modal  fade" id="leadModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">
                    {{ application.leads.form.otherData.profileProduct.name }}
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="{{ application.leads.i18n.cancel }}">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form id="leadGenForm" action="{{ application.leads.form.actionEndpoint }}">
            <div class="modal-body">
                <div class="notification-container hide" id="leadGenNotificationError">
                    <div class="alert alert-danger">
                        {{ application.leads.i18n.defaultError }}
                    </div>
                </div>
                <div class="notification-container hide" id="leadGenRequestError">
                    <div class="alert alert-danger">
                        {{ application.leads.i18n.errorMessage }}
                    </div>
                </div>
                <div class="notification-container hide" id="leadGenNotification">
                    <div class="alert alert-success">
                        {{ application.leads.i18n.sucessMessage }}
                    </div>
                </div>

                    <div class="row" id="leadGenFormData">
                        <div class="col-md-6 col-12">
                            <fieldset>
                                <div class="form-group">
                                    <label for="{{ application.leads.form.schema.firstName.title }}">{{ application.leads.form.schema.firstName.title }}</label>
                                    <input required type="{{ application.leads.form.schema.firstName.type }}" class="form-control required" name="{{ application.leads.form.schema.firstName.name }}">
                                </div>
                                <div class="form-group">
                                    <label for="{{ application.leads.form.schema.lastName.title }}">{{ application.leads.form.schema.lastName.title }}</label>
                                    <input required type="{{ application.leads.form.schema.lastName.type }}" class="form-control required" name="{{ application.leads.form.schema.lastName.name }}">
                                </div>
                                <div class="form-group">
                                    <label for="{{ application.leads.form.schema.email.title }}">{{ application.leads.form.schema.email.title }}</label>
                                    <input required type="{{ application.leads.form.schema.email.type }}" class="form-control required" name="{{ application.leads.form.schema.email.name }}">
                                </div>
                            </fieldset>
                            <fieldset>
                                <div class="form-group">
                                    <label for="{{ application.leads.form.schema.companyName.title }}">{{ application.leads.form.schema.companyName.title }}</label>
                                    <input required type="{{ application.leads.form.schema.companyName.type }}" class="form-control required" name="{{ application.leads.form.schema.companyName.name }}">
                                </div>
                                <div class="form-group">
                                    <label for="{{ application.leads.form.schema.companySize.title }}">{{ application.leads.form.schema.companySize.title }}</label>
                                    <select required class="form-control required" id="{{ application.leads.form.schema.companySize.title }}">
                                        {% for option in application.leads.form.schema.companySize.options %}
                                        <option value="{{option.value}}" data-custom-value="{{ option[customValue] }}" {{ "selected" if option.isSelected }}>{{ option.label }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </fieldset>
                            <fieldset>
                                <div class="form-group">
                                    <label for="{{ application.leads.form.schema.street1.title }}">{{ application.leads.form.schema.street1.title }}</label>
                                    <input required type="{{ application.leads.form.schema.street1.type }}" class="form-control required" name="{{ application.leads.form.schema.street1.name }}">
                                </div>
                                <div class="form-group">
                                    <label for="{{ application.leads.form.schema.street2.title }}">{{ application.leads.form.schema.street2.title }}</label>
                                    <input type="{{ application.leads.form.schema.street2.type }}" class="form-control required" name="{{ application.leads.form.schema.street2.name }}">
                                </div>
                            </fieldset>
                        </div>
                        <div class="col-md-6 col-12">
                            <fieldset>
                                <div class="form-group">
                                    <label for="{{ application.leads.form.schema.city.title }}">{{ application.leads.form.schema.city.title }}</label>
                                    <input required type="{{ application.leads.form.schema.city.type }}" class="form-control required" name="{{ application.leads.form.schema.city.name }}">
                                </div>
                                <div class="form-group">
                                    <label for="{{ application.leads.form.schema.zip.title }}">{{ application.leads.form.schema.zip.title }}</label>
                                    <input required type="{{ application.leads.form.schema.zip.type }}" class="form-control required" name="{{ application.leads.form.schema.zip.name }}">
                                </div>
                            </fieldset>
                            <fieldset>
                                <div class="form-group">
                                    <label for="{{ application.leads.form.schema.country.title }}">{{ application.leads.form.schema.country.title }}</label>
                                    <select required class="form-control required" name="{{ application.leads.form.schema.country.name }}">
                                        {% for option in application.leads.form.schema.country.options %}
                                        <option value="{{option.value}}" data-custom-value="{{ option[customValue] }}" {{ "selected" if option.isSelected }}>{{ option.label }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="{{ application.leads.form.schema.phone.title }}">{{ application.leads.form.schema.phone.title }}</label>
                                    <input required type="{{ application.leads.form.schema.phone.type }}" class="form-control required" name="{{ application.leads.form.schema.phone.name }}">
                                </div>
                                <div class="form-group">
                                    <label for="{{ application.leads.form.schema.notes.title }}">{{ application.leads.form.schema.notes.title }}</label>
                                    <textarea
                                            class="form-control"
                                            name="{{ application.leads.form.schema.notes.name }}"
                                            id="{{ application.leads.form.schema.notes.name }}"
                                            type="text"
                                            val=""
                                            placeholder="{{ application.leads.form.schema.notes.editorAttrs.placeholder }}"
                                            maxlength="{{ application.leads.form.schema.notes.editorAttrs.maxlength }}"
                                    ></textarea>
                                </div>
                            </fieldset>
                        </div>
                    </div>


            </div>
            </form>
            <div class="modal-footer">
                <button id="submitLeadGen" type="button" class="button button--primary button--full-width">
                    {{ application.leads.i18n.submit }}
                </button>
            </div>

        </div>
    </div>
</div>
<div class="modal  fade" id="requestPurchaseModal" tabindex="-1" role="dialog" aria-labelledby="requestPurchaseModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">
                    {{ application.leads.form.otherData.profileProduct.name }}
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Request Purchase
                {% set msg = {} %}
                {% for currentMsg in application.callToActions.items %}
                {% if currentMsg.actionType == 'REQUEST_PURCHASE' %}
                {% set msg = currentCta.popup %}
                {% endif %}
                {% endfor %}
                Message: {{ msg | dump }}
            </div>
            <div class="modal-footer">
                <div class="row">
                    <div class="col-md-6 col-12 text-left">
                        {% set cta = {} %}
                        {% for currentCta in application.callToActions.items %}
                        {% if currentCta.actionType == "REQUEST_PURCHASE" %}
                            {% set cta = currentCta %}
                        {% endif %}
                        {% endfor %}
                        <a href="{{cta.url}}" type="button" class="button button--primary button--full-width">Yes</a>
                    </div>
                    <div class="col-md-6 col-12 text-right">
                        <button type="button" class="button button--secondary button--full-width" data-dismiss="modal">No</button>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
<div class="modal  fade" id="requestAccessModal" tabindex="-1" role="dialog" aria-labelledby="requestPurchaseModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">
                    {{ application.leads.form.otherData.profileProduct.name }}
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Request Access
                Request Purchase
                {% set msg = {} %}
                {% for currentMsg in application.callToActions.items %}
                {% if currentMsg.actionType == 'REQUEST_ACCESS' %}
                {% set msg = currentCta.popup %}
                {% endif %}
                {% endfor %}
                Message: {{ msg | dump }}
            </div>
            <div class="modal-footer">
                <div class="row">
                    <div class="col-md-6 col-12 text-left">
                        {% set cta = {} %}
                        {% for currentCta in application.callToActions.items %}
                        {% if currentCta.actionType == 'REQUEST_ACCESS' %}
                        {% set cta = currentCta %}
                        {% endif %}
                        {% endfor %}
                        <a href="{{cta.url}}" type="button" class="button button--primary button--full-width">Yes</a>
                    </div>
                    <div class="col-md-6 col-12 text-right">
                        <button type="button" class="button button--secondary button--full-width" data-dismiss="modal">No</button>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
<script>
    const submitLead = () => {
      API = new ActionAPI();
      API.post(
          $('#leadGenForm').prop('action'),
          JSON.stringify(leadParser.getData({
                endpoint: {{ application.leads.form.actionEndpoint | dump | safe }},
                otherData: {{ application.leads.form.otherData | dump | safe }},
                customFields: {{ application.leads.form.schema.custom | dump | safe }},
                i18n: {{ application.leads.i18n | dump | safe }}
            })),
          function() {
              $('#leadGenNotification').removeClass('hide');
              $('#leadGenFormData').addClass('hide');
              $('.modal-footer').addClass('hide');
              $('#leadGenNotificationError').addClass('hide');
          },
          function() {
              $('#leadGenRequestError').removeClass('hide');
          }
      );
    }
  
    $("#submitLeadGen").on("click", function(e) {
        e.preventDefault();
  
        if ($("#leadGenForm").valid()) {
            submitLead()
        }
    })
  </script>
<section class="position-relative section--white p-0">
    <img src="{{r('/assets/images/banner-2-red.png')}}" style="width: 100%;" class="section-bg"/>
    {{productSummary(application, i18n.custom.cta_labels)}}
</section>
<div id="apptop" data-vue-page="profile">
    <div id="profile-page" class="profile-page">
        <section class="container">
            {{ productTabs(application) }}
        </section>
        <div id="successMessage" class="alert alert-success alert-dismissible fade show" role="alert" style="display: none">
            <div class="container">
                <div class="text-center" id="requestPurchaseSuccess" style="display: none">
                    {{ application.actionMessages.requestPurchaseSuccess }}
                </div>
                <div class="text-center" id="requestAccessSuccess" style="display: none">
                    {{ application.actionMessages.requestAccessSuccess }}
                </div>
            </div>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div id="failureMessage" class="alert alert-danger alert-dismissible fade show" role="alert" style="display: none">
            <div class="container">
                <div class="text-center" id="requestPurchaseFail" style="display: none">
                    {{ application.actionMessages.requestPurchaseFail }}
                </div>
                <div class="text-center" id="requestAccessFail" style="display: none">
                    {{ application.actionMessages.requestAccessFail }}
                </div>
            </div>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <section id="Overview" class="section--gutter">
            {{ productOverview(application, i18n.custom.cta_labels) }}
        </section>
    </div>
</div>

{% if application.features.items.length > 0 %}
<section id="Features" class="section section--light-grey">
    {% for navItem in application.navigation.items %}
    {% if 'features' === navItem.value %}
    {{ carousel('profile', application.features, application.features.items, 'profile', true, false, false, 'desktop',
    1, true, false, navItem.label)
    }}
    {% endif %}
    {% endfor %}
</section>
{% endif %}

{% if application.editions.items.length > 0 %}
<section id="Editions" class="section section--white">
    {{editionsPricing(application.editions, i18n.custom.cta_labels)}}
</section>
{% endif %}
{% if application.addonProducts.items.length > 0 %}
<section id="Addons" class="section section--white">
    {{addonProducts(application.addonProducts, i18n.custom.cta_labels)}}
</section>
{% endif %}
<div id="appbottom" data-vue-page="profile2">
    {% if (application.support.termsUrl != NULL) or (application.support.privacyUrl != NULL) or (application.support.knowledgebaseUrl != NULL) %}
    <section id="Policies" class="section section--gallery gutter__large--y">
        {{ productSupport(application) }}
    </section>
    {% endif %}
    <!--    <Toaster :application="{{ application|dump }}"></Toaster>-->
</div>
<section>
    <h1>dump app</h1><br>
    {{ application | dump | safe }}
</section>
{% endblock %}

{% endblock %}

{% block analytics_data %}
{{ utagDataScript({
journey_name: 'AppDirect Purchase',
journey_type: 'acquisition',
page_name: 'uk:business:app direct:product:Microsoft Office 365',
page_title: 'Microsoft Office 365',
site_section_lvl_3: 'product',
product_brand: 'Microsoft',
product_category: 'Business Software',
product_event: 'view',
product_id: '',
product_name: 'Office 365',
product_sku: '',
product_target_segment: 'small business'
}) }}
{% endblock %}
